<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã¾ã¡ã®ãƒ‘ãƒ³å·¥æˆ¿ï½œãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ—ãƒª</title>
  <style>
    :root{
      --bg:#faf7f2;
      --card:#ffffff;
      --ink:#1d1d1f;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#c27b38;
      --accent2:#8b5cf6;
      --good:#16a34a;
      --warn:#b45309;
      --bad:#dc2626;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius:16px;
      --radius2:12px;
      --focus: 0 0 0 3px rgba(194,123,56,.25);
      --maxw: 1100px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", "Meiryo", sans-serif;
      color:var(--ink);
      background:
        radial-gradient(900px 600px at 10% 0%, rgba(194,123,56,.12), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(139,92,246,.10), transparent 55%),
        var(--bg);
    }

    a{ color:inherit; }
    button,input,select,textarea{ font:inherit; }

    .wrap{ max-width: var(--maxw); margin: 0 auto; padding: 22px 16px 40px; }

    header{
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
      border:1px solid rgba(229,231,235,.7);
      border-radius: var(--radius);
      padding: 18px 18px;
      box-shadow: var(--shadow);
      position: sticky;
      top: 12px;
      z-index: 10;
    }

    .head-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap: wrap;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      min-width: 260px;
    }

    .logo{
      width:44px; height:44px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(194,123,56,.95), rgba(194,123,56,.55));
      display:grid; place-items:center;
      box-shadow: 0 10px 20px rgba(194,123,56,.25);
      flex: 0 0 auto;
    }
    .logo svg{ width:28px; height:28px; fill:#fff; }

    .brand h1{
      margin:0;
      font-size: 18px;
      letter-spacing: .02em;
      line-height: 1.2;
    }
    .subline{
      margin-top: 4px;
      color: var(--muted);
      font-size: 12px;
    }

    .meta{
      display:flex;
      align-items:flex-start;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      text-align:right;
      margin-left:auto;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.9);
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1;
    }
    .pill strong{ color: var(--ink); font-weight: 700; }

    .btn{
      border:1px solid rgba(0,0,0,.08);
      background: #fff;
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      box-shadow: 0 6px 16px rgba(0,0,0,.06);
      line-height: 1;
      display:inline-flex;
      gap:8px;
      align-items:center;
      color: var(--ink);
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 26px rgba(0,0,0,.10); }
    .btn:active{ transform: translateY(0); }
    .btn:focus{ outline:none; box-shadow: var(--shadow), var(--focus); }

    .btn.primary{
      background: linear-gradient(135deg, rgba(194,123,56,.95), rgba(194,123,56,.75));
      border-color: rgba(194,123,56,.25);
      color:#fff;
      box-shadow: 0 10px 26px rgba(194,123,56,.20);
    }
    .btn.primary:hover{ box-shadow: 0 14px 34px rgba(194,123,56,.28); }
    .btn.ghost{
      background: rgba(255,255,255,.75);
    }
    .btn.small{
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 12px;
    }

    .btn .ico{
      width:16px; height:16px; display:inline-block;
    }
    .btn .ico svg{ width:16px; height:16px; fill: currentColor; }

    .grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .panel{
      border:1px solid rgba(229,231,235,.85);
      background: rgba(255,255,255,.7);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: var(--shadow);
    }

    .controls{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .controls .row{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: space-between;
    }

    .field{
      display:flex;
      flex-direction: column;
      gap: 6px;
      min-width: 190px;
      flex: 1 1 190px;
    }

    label{
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
    }

    select,input[type="search"]{
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.92);
      outline:none;
      transition: box-shadow .12s ease, border-color .12s ease;
    }
    select:focus,input[type="search"]:focus{ box-shadow: var(--focus); border-color: rgba(194,123,56,.35); }

    .hint{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .cards{
      display:grid;
      grid-template-columns: repeat(1, minmax(0,1fr));
      gap: 12px;
    }

    @media (min-width: 740px){
      .grid{ grid-template-columns: 380px 1fr; align-items:start; }
      .cards{ grid-template-columns: repeat(2, minmax(0,1fr)); }
      header{ padding: 18px 20px; }
    }
    @media (min-width: 1020px){
      .cards{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }

    .card{
      border: 1px solid rgba(229,231,235,.9);
      border-radius: var(--radius);
      background: rgba(255,255,255,.9);
      box-shadow: 0 8px 22px rgba(0,0,0,.06);
      overflow:hidden;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      position: relative;
      min-height: 210px;
      display:flex;
      flex-direction: column;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: 0 14px 34px rgba(0,0,0,.10);
      border-color: rgba(194,123,56,.25);
    }
    .card:focus{
      outline:none;
      box-shadow: 0 14px 34px rgba(0,0,0,.10), var(--focus);
    }

    .card-top{
      padding: 12px 12px 10px;
      display:flex;
      gap: 10px;
      align-items:center;
    }

    .thumb{
      width: 54px; height:54px;
      border-radius: 14px;
      background:
        radial-gradient(24px 24px at 30% 30%, rgba(255,255,255,.8), transparent 60%),
        linear-gradient(135deg, rgba(194,123,56,.25), rgba(139,92,246,.18));
      border: 1px solid rgba(229,231,235,.9);
      flex: 0 0 auto;
      display:grid;
      place-items:center;
      overflow:hidden;
    }
    .thumb svg{ width:32px; height:32px; opacity:.8; }

    .title{
      display:flex;
      flex-direction: column;
      gap: 3px;
      min-width: 0;
    }
    .name{
      font-weight: 800;
      font-size: 14px;
      letter-spacing: .02em;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .meta2{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items:center;
    }
    .tag{
      font-size: 11px;
      color: var(--muted);
      border:1px solid var(--line);
      background: rgba(255,255,255,.85);
      padding: 4px 8px;
      border-radius: 999px;
      line-height: 1;
    }
    .tag.new{
      color:#fff;
      border-color: rgba(22,163,74,.25);
      background: linear-gradient(135deg, rgba(22,163,74,.9), rgba(22,163,74,.6));
    }
    .tag.low{
      color:#fff;
      border-color: rgba(180,83,9,.25);
      background: linear-gradient(135deg, rgba(180,83,9,.9), rgba(180,83,9,.6));
    }

    .card-body{
      padding: 0 12px 12px;
      display:flex;
      flex-direction: column;
      gap: 10px;
      flex: 1 1 auto;
    }
    .desc{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow:hidden;
      min-height: 54px;
    }
    .price-row{
      margin-top: auto;
      display:flex;
      justify-content: space-between;
      align-items:flex-end;
      gap: 8px;
    }
    .price{
      font-weight: 900;
      font-size: 16px;
      letter-spacing: .02em;
    }
    .rating{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }
    .badge{
      position:absolute;
      top: 10px;
      right: 10px;
      display:none;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(194,123,56,.95), rgba(194,123,56,.70));
      color:#fff;
      font-size: 12px;
      font-weight: 800;
      border: 1px solid rgba(194,123,56,.25);
      box-shadow: 0 12px 28px rgba(194,123,56,.22);
    }
    .badge.show{ display:inline-flex; }
    .badge svg{ width:14px; height:14px; fill:#fff; }

    .section-title{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }
    .section-title h2{
      margin: 0;
      font-size: 14px;
      letter-spacing: .02em;
    }
    .count{
      font-size: 12px;
      color: var(--muted);
    }

    .empty{
      padding: 18px;
      border: 1px dashed rgba(107,114,128,.35);
      border-radius: var(--radius);
      color: var(--muted);
      background: rgba(255,255,255,.7);
      text-align:center;
      line-height: 1.6;
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background: rgba(17,24,39,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 50;
    }
    .modal-backdrop.show{
      display:flex;
      animation: fadeIn .15s ease;
    }
    @keyframes fadeIn{
      from{ opacity: 0; }
      to{ opacity: 1; }
    }
    .modal{
      width:min(760px, 100%);
      border-radius: 18px;
      background: rgba(255,255,255,.96);
      border: 1px solid rgba(229,231,235,.9);
      box-shadow: 0 24px 70px rgba(0,0,0,.25);
      overflow:hidden;
      transform: translateY(6px);
      animation: popIn .16s ease forwards;
    }
    @keyframes popIn{
      from{ transform: translateY(10px) scale(.99); opacity: .92; }
      to{ transform: translateY(0) scale(1); opacity: 1; }
    }
    .modal-head{
      padding: 14px 14px 12px;
      border-bottom: 1px solid rgba(229,231,235,.9);
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap:10px;
    }
    .modal-head h3{
      margin:0;
      font-size: 16px;
      letter-spacing: .02em;
    }
    .modal-head .sub{
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .modal-body{
      padding: 14px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 740px){
      .modal-body{ grid-template-columns: 1.2fr .8fr; }
    }
    .modal-card{
      border: 1px solid rgba(229,231,235,.9);
      border-radius: 16px;
      background: rgba(255,255,255,.92);
      padding: 12px;
    }
    .kv{
      display:grid;
      grid-template-columns: 110px 1fr;
      gap: 8px 10px;
      margin:0;
      font-size: 13px;
      line-height: 1.55;
    }
    .kv dt{ color: var(--muted); font-weight: 800; }
    .kv dd{ margin:0; }
    .modal-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
      padding: 12px 14px 14px;
      border-top: 1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.92);
    }

    .close-x{
      border:none;
      background: transparent;
      cursor:pointer;
      padding: 8px;
      border-radius: 10px;
      color: var(--muted);
    }
    .close-x:hover{ background: rgba(107,114,128,.12); color: var(--ink); }
    .close-x:focus{ outline:none; box-shadow: var(--focus); }

    /* Reservation */
    .form{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 8px;
    }
    .form .frow{
      display:grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }
    @media (min-width: 740px){
      .form .frow.two{ grid-template-columns: 1fr 1fr; }
    }
    .input{
      display:flex;
      flex-direction:column;
      gap: 6px;
    }
    .input input, .input textarea{
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.95);
      outline:none;
    }
    .input textarea{ min-height: 76px; resize: vertical; }
    .input input:focus, .input textarea:focus{ box-shadow: var(--focus); border-color: rgba(194,123,56,.35); }
    .err{
      color: var(--bad);
      font-size: 12px;
      min-height: 16px;
    }
    .ok{
      color: var(--good);
      font-size: 12px;
      line-height: 1.4;
    }

    /* SNS copy */
    .sns{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .sns .box{
      border: 1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.92);
      border-radius: 14px;
      padding: 12px;
      display:flex;
      flex-direction: column;
      gap: 10px;
    }
    .sns .box h4{
      margin: 0;
      font-size: 13px;
      letter-spacing: .02em;
    }
    .sns textarea{
      width:100%;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(255,255,255,.95);
      min-height: 76px;
      resize: vertical;
      outline:none;
    }
    .sns textarea:focus{ box-shadow: var(--focus); border-color: rgba(194,123,56,.35); }
    .sns .tools{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content: space-between;
    }
    .len{
      font-size: 12px;
      color: var(--muted);
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(17,24,39,.92);
      color: #fff;
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 12px;
      display:none;
      align-items:center;
      gap:8px;
      z-index: 80;
      box-shadow: 0 16px 40px rgba(0,0,0,.25);
      max-width: min(560px, 92vw);
      line-height: 1.4;
    }
    .toast.show{ display:flex; animation: toastIn .15s ease; }
    @keyframes toastIn{
      from{ transform: translateX(-50%) translateY(6px); opacity: .92; }
      to{ transform: translateX(-50%) translateY(0); opacity: 1; }
    }

    .reservation-summary{
      margin-top: 12px;
      border: 1px solid rgba(229,231,235,.9);
      border-radius: var(--radius);
      background: rgba(255,255,255,.92);
      padding: 12px;
    }
    .reservation-summary h3{
      margin: 0 0 8px;
      font-size: 14px;
    }
    .summary-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 8px;
      font-size: 13px;
      line-height: 1.55;
      color: var(--ink);
    }
    @media (min-width: 740px){
      .summary-grid{ grid-template-columns: 1fr 1fr; }
    }
    .summary-item{
      border: 1px solid rgba(229,231,235,.9);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,.95);
    }
    .summary-item .k{ color: var(--muted); font-weight: 800; font-size: 12px; }
    .summary-item .v{ margin-top: 4px; font-weight: 700; }

    .sr-only{
      position:absolute;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header aria-label="ãƒ˜ãƒƒãƒ€ãƒ¼">
      <div class="head-row">
        <div class="brand">
          <div class="logo" aria-hidden="true" title="ã¾ã¡ã®ãƒ‘ãƒ³å·¥æˆ¿">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path d="M12 2c3.8 0 6.9 2.5 6.9 5.6 0 .6-.1 1.2-.4 1.7 1.7.8 2.9 2.4 2.9 4.2 0 2.7-2.4 4.8-5.8 4.8H8.4C5 18.3 2.6 16.2 2.6 13.5c0-1.8 1.2-3.4 2.9-4.2-.3-.5-.4-1.1-.4-1.7C5.1 4.5 8.2 2 12 2Zm0 2c-2.7 0-4.9 1.7-4.9 3.6 0 .7.2 1.3.6 1.8.3.4.2 1-.3 1.2C5.7 11.2 4.6 12.2 4.6 13.5c0 1.5 1.7 2.8 3.8 2.8h7.2c2.1 0 3.8-1.3 3.8-2.8 0-1.3-1.1-2.3-2.8-2.9-.5-.2-.7-.8-.3-1.2.4-.5.6-1.1.6-1.8C16.9 5.7 14.7 4 12 4Z"/>
            </svg>
          </div>
          <div>
            <h1 id="shopName">ã¾ã¡ã®ãƒ‘ãƒ³å·¥æˆ¿</h1>
            <div class="subline">
              <span id="todayText">ä»Šæ—¥: --</span> ãƒ» å–¶æ¥­æ™‚é–“: <strong>7:30-18:00</strong> ãƒ» <strong>å£²ã‚Šåˆ‡ã‚Œæ³¨æ„</strong>
            </div>
          </div>
        </div>

        <div class="meta" aria-label="åº—èˆ—ãƒ¡ã‚¿æƒ…å ±ã¨æ“ä½œ">
          <div class="pill" aria-label="ä»Šæ—¥ã®æ—¥ä»˜">
            <span aria-hidden="true">ğŸ“…</span>
            <span><strong id="todayDate">----</strong></span>
          </div>
          <div class="pill" aria-label="é¸æŠä¸­ã®å•†å“">
            <span aria-hidden="true">ğŸ¥</span>
            <span>é¸æŠä¸­: <strong id="selectedName">æœªé¸æŠ</strong></span>
          </div>
          <button id="btnPick" class="btn primary" type="button" aria-label="æœ¬æ—¥ã®ãŠã™ã™ã‚ã«æ›´æ–°">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M12 2l2.4 6.7H21l-5.4 4 2.1 6.8-5.7-4.1-5.7 4.1 2.1-6.8L3 8.7h6.6L12 2z"/></svg>
            </span>
            æœ¬æ—¥ã®ãŠã™ã™ã‚ã«æ›´æ–°
          </button>
          <button id="btnScrollReservation" class="btn ghost" type="button" aria-label="äºˆç´„å†…å®¹ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«">
            <span class="ico" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M7 2h10a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Zm0 2v16h10V4H7Zm2 3h6v2H9V7Zm0 4h6v2H9v-2Zm0 4h6v2H9v-2Z"/></svg>
            </span>
            äºˆç´„å†…å®¹
          </button>
        </div>
      </div>
    </header>

    <main class="grid" aria-label="ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„">
      <aside class="panel" aria-label="çµã‚Šè¾¼ã¿ãƒ»ä¸¦ã³æ›¿ãˆ">
        <div class="controls">
          <div class="section-title">
            <h2>çµã‚Šè¾¼ã¿ãƒ»ä¸¦ã³æ›¿ãˆ</h2>
            <div class="count" id="resultCount">-- ä»¶</div>
          </div>

          <div class="row">
            <div class="field">
              <label for="filterCategory">ã‚«ãƒ†ã‚´ãƒª</label>
              <select id="filterCategory" aria-label="ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿">
                <option value="all">å…¨ã¦</option>
                <option value="é£Ÿãƒ‘ãƒ³">é£Ÿãƒ‘ãƒ³</option>
                <option value="è“å­ãƒ‘ãƒ³">è“å­ãƒ‘ãƒ³</option>
                <option value="æƒ£èœãƒ‘ãƒ³">æƒ£èœãƒ‘ãƒ³</option>
                <option value="å­£ç¯€é™å®š">å­£ç¯€é™å®š</option>
              </select>
            </div>

            <div class="field">
              <label for="sortBy">ä¸¦ã³æ›¿ãˆ</label>
              <select id="sortBy" aria-label="ä¸¦ã³æ›¿ãˆ">
                <option value="popular">äººæ°—é †</option>
                <option value="priceAsc">ä¾¡æ ¼å®‰ã„é †</option>
                <option value="newest">æ–°ç€é †</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="field" style="flex: 1 1 100%;">
              <label for="searchText">æ¤œç´¢ï¼ˆå•†å“åãƒ»èª¬æ˜ï¼‰</label>
              <input id="searchText" type="search" placeholder="ä¾‹ï¼šãƒã‚¿ãƒ¼ã€ã‚«ãƒ¬ãƒ¼ã€ã‚Šã‚“ã”â€¦" aria-label="æ¤œç´¢" />
            </div>
          </div>

          <div class="hint">
            ãƒ’ãƒ³ãƒˆï¼šã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒé–‹ãã€å–ã‚Šç½®ãäºˆç´„ã‚„SNSç”¨ã‚³ãƒ”ãƒ¼ãŒç”Ÿæˆã§ãã¾ã™ã€‚
          </div>

          <div class="reservation-summary" id="reservationSummary" aria-label="äºˆç´„å†…å®¹ï¼ˆä¿å­˜ã•ã‚Œã¾ã™ï¼‰">
            <div class="section-title" style="margin:0 0 8px;">
              <h3>äºˆç´„å†…å®¹ï¼ˆä¿å­˜ã•ã‚Œã¾ã™ï¼‰</h3>
              <button id="btnClearReservation" class="btn small" type="button" aria-label="äºˆç´„å†…å®¹ã‚’æ¶ˆå»">æ¶ˆå»</button>
            </div>
            <div id="reservationEmpty" class="hint">ã¾ã äºˆç´„ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å•†å“è©³ç´°ã‹ã‚‰ã€Œå–ã‚Šç½®ãäºˆç´„ã€ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚</div>
            <div id="reservationList" class="summary-grid" style="display:none;"></div>
          </div>

          <div class="panel" style="padding:12px; box-shadow:none; background: rgba(255,255,255,.55);" aria-label="SNSç”¨ã‚³ãƒ”ãƒ¼">
            <div class="section-title" style="margin:0 0 8px;">
              <h2>SNSç”¨ã‚³ãƒ”ãƒ¼</h2>
              <div class="count" id="snsInfo">æœªé¸æŠ</div>
            </div>
            <div class="sns">
              <div class="box">
                <h4>Xï¼ˆæ—§Twitterï¼‰å‘ã‘ï¼ˆ100æ–‡å­—ä»¥å†…ç›®å®‰ï¼‰</h4>
                <textarea id="xCopy" readonly aria-label="Xå‘ã‘ã‚³ãƒ”ãƒ¼"></textarea>
                <div class="tools">
                  <span class="len" id="xLen">0 æ–‡å­—</span>
                  <button id="btnCopyX" class="btn small" type="button" aria-label="Xå‘ã‘ã‚³ãƒ”ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼">
                    <span class="ico" aria-hidden="true">
                      <svg viewBox="0 0 24 24"><path d="M16 1H6a2 2 0 0 0-2 2v12h2V3h10V1Zm3 4H10a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H10V7h9v14Z"/></svg>
                    </span>
                    ã‚³ãƒ”ãƒ¼
                  </button>
                </div>
              </div>

              <div class="box">
                <h4>Instagramå‘ã‘ï¼ˆ120æ–‡å­—ç¨‹åº¦ç›®å®‰ï¼‰</h4>
                <textarea id="igCopy" readonly aria-label="Instagramå‘ã‘ã‚³ãƒ”ãƒ¼"></textarea>
                <div class="tools">
                  <span class="len" id="igLen">0 æ–‡å­—</span>
                  <button id="btnCopyIG" class="btn small" type="button" aria-label="Instagramå‘ã‘ã‚³ãƒ”ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼">
                    <span class="ico" aria-hidden="true">
                      <svg viewBox="0 0 24 24"><path d="M16 1H6a2 2 0 0 0-2 2v12h2V3h10V1Zm3 4H10a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H10V7h9v14Z"/></svg>
                    </span>
                    ã‚³ãƒ”ãƒ¼
                  </button>
                </div>
              </div>
            </div>
            <div class="hint" style="margin-top:10px;">
              â€» ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆã§ã™ã€‚å•†å“åã‚„ç‰¹å¾´ã¯ã‚«ãƒ¼ãƒ‰/è©³ç´°ã‚’é¸ã¶ã ã‘ã§æ›´æ–°ã•ã‚Œã¾ã™ã€‚
            </div>
          </div>
        </div>
      </aside>

      <section class="panel" aria-label="å•†å“ä¸€è¦§">
        <div class="section-title">
          <h2>å•†å“ã‚«ãƒ¼ãƒ‰ä¸€è¦§</h2>
          <div class="count" id="noticeText">æœ¬æ—¥ã®ãŠã™ã™ã‚ã¯ãƒãƒƒã‚¸è¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>
        <div id="cards" class="cards" aria-live="polite"></div>
        <div id="emptyState" class="empty" style="display:none;">
          æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹å•†å“ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br />
          ãƒ•ã‚£ãƒ«ã‚¿ã‚„æ¤œç´¢æ¡ä»¶ã‚’å¤‰ãˆã¦ã¿ã¦ãã ã•ã„ã€‚
        </div>
      </section>
    </main>
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-head">
        <div>
          <h3 id="modalTitle">å•†å“è©³ç´°</h3>
          <div class="sub" id="modalSub"></div>
        </div>
        <button class="close-x" id="btnCloseModal" type="button" aria-label="é–‰ã˜ã‚‹ï¼ˆEscï¼‰">
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
            <path fill="currentColor" d="M18.3 5.7a1 1 0 0 0-1.4 0L12 10.6 7.1 5.7A1 1 0 0 0 5.7 7.1l4.9 4.9-4.9 4.9a1 1 0 1 0 1.4 1.4l4.9-4.9 4.9 4.9a1 1 0 0 0 1.4-1.4l-4.9-4.9 4.9-4.9a1 1 0 0 0 0-1.4Z"/>
          </svg>
          <span class="sr-only">é–‰ã˜ã‚‹</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="modal-card" aria-label="è©³ç´°æƒ…å ±">
          <div style="display:flex; gap:12px; align-items:center;">
            <div class="thumb" aria-hidden="true" style="width:72px;height:72px;border-radius:18px;">
              <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                <path fill="currentColor" d="M3 12c0-4.4 4-8 9-8s9 3.6 9 8-4 8-9 8-9-3.6-9-8Zm3.5 0c0 2.9 2.5 5.3 5.5 5.3s5.5-2.4 5.5-5.3S15 6.7 12 6.7 6.5 9.1 6.5 12Z"/>
              </svg>
            </div>
            <div style="min-width:0;">
              <div style="font-weight:900; font-size:18px; letter-spacing:.02em;" id="modalName">--</div>
              <div style="margin-top:6px; color:var(--muted); font-size:13px;" id="modalDesc">--</div>
            </div>
          </div>

          <hr style="border:none; border-top:1px solid rgba(229,231,235,.9); margin:12px 0;" />

          <dl class="kv" id="modalKv">
            <!-- injected -->
          </dl>

          <div style="margin-top: 10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
            <div class="pill" aria-label="äººæ°—åº¦">
              <span aria-hidden="true">â­</span>
              <span>äººæ°—åº¦: <strong id="modalRating">-</strong></span>
            </div>
            <div class="pill" aria-label="åœ¨åº«è¡¨ç¤º">
              <span aria-hidden="true">ğŸ§º</span>
              <span id="modalStockText">åœ¨åº«: -</span>
            </div>
          </div>
        </div>

        <div class="modal-card" aria-label="å–ã‚Šç½®ãäºˆç´„ï¼ˆæ“¬ä¼¼ï¼‰">
          <div style="display:flex; align-items:baseline; justify-content:space-between; gap:10px;">
            <div style="font-weight:900; letter-spacing:.02em;">å–ã‚Šç½®ãäºˆç´„ï¼ˆæ“¬ä¼¼ï¼‰</div>
            <div class="hint" id="formTargetName">å¯¾è±¡: --</div>
          </div>

          <form id="reserveForm" class="form" novalidate>
            <div class="frow two">
              <div class="input">
                <label for="rName">ãŠåå‰ï¼ˆå¿…é ˆï¼‰</label>
                <input id="rName" type="text" autocomplete="name" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ" />
                <div class="err" id="errName"></div>
              </div>
              <div class="input">
                <label for="rPhone">é›»è©±ç•ªå·ï¼ˆå¿…é ˆï¼‰</label>
                <input id="rPhone" type="tel" autocomplete="tel" placeholder="ä¾‹ï¼š09012345678" />
                <div class="err" id="errPhone"></div>
              </div>
            </div>

            <div class="frow two">
              <div class="input">
                <label for="rTime">å—å–å¸Œæœ›æ™‚é–“ï¼ˆå¿…é ˆï¼‰</label>
                <input id="rTime" type="time" />
                <div class="err" id="errTime"></div>
              </div>
              <div class="input">
                <label for="rQty">å€‹æ•°ï¼ˆå¿…é ˆï¼‰</label>
                <input id="rQty" type="number" min="1" step="1" inputmode="numeric" placeholder="ä¾‹ï¼š2" />
                <div class="err" id="errQty"></div>
              </div>
            </div>

            <div class="input">
              <label for="rMemo">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
              <textarea id="rMemo" placeholder="ä¾‹ï¼šã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ç¢ºèªæ¸ˆã¿ã€æ€¥ãã§å—ã‘å–ã‚ŠãŸã„ç­‰"></textarea>
              <div class="err" id="errMemo"></div>
            </div>

            <div id="reserveOk" class="ok" style="display:none;"></div>

            <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end;">
              <button id="btnSubmitReserve" class="btn primary" type="submit" aria-label="äºˆç´„å†…å®¹ã‚’ä¿å­˜ï¼ˆæ“¬ä¼¼é€ä¿¡ï¼‰">
                <span class="ico" aria-hidden="true">
                  <svg viewBox="0 0 24 24"><path d="M2 12l19-9-5 19-5-7-9-3Zm9 3.7 7.8-7.8-9.6 4.5 1.8 3.3Z"/></svg>
                </span>
                äºˆç´„å†…å®¹ã‚’ä¿å­˜
              </button>
              <button id="btnUseForSNS" class="btn" type="button" aria-label="ã“ã®å•†å“ã§SNSç”¨ã‚³ãƒ”ãƒ¼ã‚’æ›´æ–°">
                <span class="ico" aria-hidden="true">
                  <svg viewBox="0 0 24 24"><path d="M16 8a3 3 0 1 0-2.8-4H13a3 3 0 0 0 3 4Zm-8 8a3 3 0 1 0 2.8 4H11a3 3 0 0 0-3-4Zm0-2c.6 0 1.1.2 1.6.5l7-4A3 3 0 0 1 17 8c0-.6-.2-1.1-.5-1.6l-7 4A3 3 0 0 1 8 14Z"/></svg>
                </span>
                SNSã‚³ãƒ”ãƒ¼æ›´æ–°
              </button>
            </div>

            <div class="hint">
              â€» é€ä¿¡ã¯è¡Œã„ã¾ã›ã‚“ã€‚å…¥åŠ›å†…å®¹ã¯ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã€ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚æ®‹ã‚Šã¾ã™ã€‚
            </div>
          </form>
        </div>
      </div>

      <div class="modal-actions">
        <button id="btnCloseModal2" class="btn" type="button" aria-label="é–‰ã˜ã‚‹">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    (() => {
      "use strict";

      /** ===== Data ===== */
      const SHOP = {
        name: "ã¾ã¡ã®ãƒ‘ãƒ³å·¥æˆ¿",
        hours: "7:30-18:00",
        note: "å£²ã‚Šåˆ‡ã‚Œæ³¨æ„",
      };

      /** @type {Array<{
       * id:number, name:string, category:string, price:number, description:string, rating:number,
       * isNew:boolean, tags:string[], createdAt:string,
       * details:{ingredients:string, allergens:string, bakeTime:string, storage:string},
       * stock:number
       * }>} */
      const products = [
        {
          id: 101,
          name: "æ¹¯ç¨®ã‚‚ã¡ã‚‚ã¡é£Ÿãƒ‘ãƒ³",
          category: "é£Ÿãƒ‘ãƒ³",
          price: 380,
          description: "æ¹¯ç¨®è£½æ³•ã§ã—ã£ã¨ã‚Šã€‚ç¿Œæ—¥ã‚‚ãƒˆãƒ¼ã‚¹ãƒˆã§ãµã‚ã£ã¨æˆ»ã‚‹å®šç•ªã€‚",
          rating: 5,
          isNew: false,
          tags: ["å®šç•ª", "æœé£Ÿ"],
          createdAt: "2025-11-10",
          details: {
            ingredients: "å°éº¦ç²‰ã€æ¹¯ç¨®ã€ãƒã‚¿ãƒ¼ã€ç ‚ç³–ã€å¡©ã€é…µæ¯",
            allergens: "å°éº¦ãƒ»ä¹³",
            bakeTime: "8:30 / 11:00 / 15:00",
            storage: "å¸¸æ¸©ã§1ã€œ2æ—¥ã€å†·å‡ã§ç´„2é€±é–“",
          },
          stock: 0,
        },
        {
          id: 102,
          name: "å¡©ãƒã‚¿ãƒ¼ãƒ­ãƒ¼ãƒ«",
          category: "è“å­ãƒ‘ãƒ³",
          price: 180,
          description: "è¡¨é¢ã¯ã‚«ãƒªãƒƒã€ä¸­ã¯ã˜ã‚…ã‚ã£ã€‚ç™ºé…µãƒã‚¿ãƒ¼ã®é¦™ã‚ŠãŒåºƒãŒã‚Šã¾ã™ã€‚",
          rating: 4,
          isNew: false,
          tags: ["äººæ°—", "ãŠã‚„ã¤"],
          createdAt: "2025-10-22",
          details: {
            ingredients: "å°éº¦ç²‰ã€ç™ºé…µãƒã‚¿ãƒ¼ã€ç‰›ä¹³ã€ç ‚ç³–ã€å¡©ã€é…µæ¯",
            allergens: "å°éº¦ãƒ»ä¹³",
            bakeTime: "9:30 / 13:00 / 16:30",
            storage: "å½“æ—¥ä¸­æ¨å¥¨ã€‚å†·å‡å¯ï¼ˆè‡ªç„¶è§£å‡â†’ãƒˆãƒ¼ã‚¹ãƒˆï¼‰",
          },
          stock: 0,
        },
        {
          id: 103,
          name: "è‡ªå®¶è£½ã‚«ãƒ¬ãƒ¼ãƒ‘ãƒ³",
          category: "æƒ£èœãƒ‘ãƒ³",
          price: 260,
          description: "ç‰ã­ãã®ç”˜ã¿ã¨ã‚¹ãƒ‘ã‚¤ã‚¹ã®ã‚³ã‚¯ã€‚æšã’ãŸã¦ãŒç‹™ã„ç›®ã§ã™ã€‚",
          rating: 5,
          isNew: false,
          tags: ["æšã’ãŸã¦", "ãƒ©ãƒ³ãƒ"],
          createdAt: "2025-11-01",
          details: {
            ingredients: "å°éº¦ç²‰ã€ç‰›è‚‰ã€ç‰ã­ãã€ã‚¹ãƒ‘ã‚¤ã‚¹ã€ãƒ‘ãƒ³ç²‰ã€æ²¹",
            allergens: "å°éº¦ãƒ»ä¹³ï¼ˆå¾®é‡ï¼‰",
            bakeTime: "10:30 / 12:30 / 14:30",
            storage: "å½“æ—¥ä¸­ã€‚æ¸©ã‚ç›´ã—ã¯ãƒˆãƒ¼ã‚¹ã‚¿ãƒ¼2ã€œ3åˆ†",
          },
          stock: 0,
        },
        {
          id: 104,
          name: "å­£ç¯€ã®ã‚Šã‚“ã”ãƒ‡ãƒ‹ãƒƒã‚·ãƒ¥",
          category: "å­£ç¯€é™å®š",
          price: 320,
          description: "ã˜ã£ãã‚Šç…®ãŸã‚Šã‚“ã”ã«ã‚·ãƒŠãƒ¢ãƒ³ã®ä½™éŸ»ã€‚ã‚µã‚¯ã‚µã‚¯å±¤ãŒè‡ªæ…¢ã€‚",
          rating: 4,
          isNew: true,
          tags: ["å­£ç¯€", "ã”è¤’ç¾"],
          createdAt: "2025-11-25",
          details: {
            ingredients: "å°éº¦ç²‰ã€ãƒã‚¿ãƒ¼ã€ã‚Šã‚“ã”ã€ç ‚ç³–ã€ã‚·ãƒŠãƒ¢ãƒ³",
            allergens: "å°éº¦ãƒ»ä¹³ãƒ»ã‚Šã‚“ã”",
            bakeTime: "11:30 / 14:00",
            storage: "å½“æ—¥ä¸­æ¨å¥¨ã€‚ç¿Œæ—¥ã¯è»½ãæ¸©ã‚ã‚‹ã¨é¦™ã‚Šå¾©æ´»",
          },
          stock: 0,
        },
        {
          id: 105,
          name: "æ˜å¤ªãƒãƒ¼ã‚ºãƒ•ãƒ©ãƒ³ã‚¹",
          category: "æƒ£èœãƒ‘ãƒ³",
          price: 340,
          description: "å¤–ã¯ãƒ‘ãƒªãƒƒã¨ãƒ•ãƒ©ãƒ³ã‚¹ç”Ÿåœ°ã«ã€æ˜å¤ªãƒãƒ¨ã¨ãƒãƒ¼ã‚ºã‚’ãŸã£ã·ã‚Šã€‚",
          rating: 4,
          isNew: true,
          tags: ["ãŠã¤ã¾ã¿", "æº€è¶³"],
          createdAt: "2025-11-20",
          details: {
            ingredients: "å°éº¦ç²‰ã€æ˜å¤ªå­ã€ãƒãƒ¨ãƒãƒ¼ã‚ºã€ãƒãƒ¼ã‚ºã€å¡©",
            allergens: "å°éº¦ãƒ»åµãƒ»ä¹³",
            bakeTime: "10:00 / 13:30 / 16:00",
            storage: "å½“æ—¥ä¸­ã€‚æ¸©ã‚ç›´ã—ã¯ãƒˆãƒ¼ã‚¹ã‚¿ãƒ¼2åˆ†",
          },
          stock: 0,
        },
        {
          id: 106,
          name: "ãµã‚ãµã‚ã‚¯ãƒªãƒ¼ãƒ ãƒ‘ãƒ³",
          category: "è“å­ãƒ‘ãƒ³",
          price: 220,
          description: "è‡ªå®¶ç‚Šãã‚«ã‚¹ã‚¿ãƒ¼ãƒ‰ã€‚å£ã©ã‘é‡è¦–ã§è»½ã‚ã®ç”˜ã•ã«ä»•ä¸Šã’ã¾ã—ãŸã€‚",
          rating: 5,
          isNew: false,
          tags: ["äººæ°—", "å®šç•ª"],
          createdAt: "2025-09-30",
          details: {
            ingredients: "å°éº¦ç²‰ã€åµã€ç‰›ä¹³ã€ç ‚ç³–ã€ãƒã‚¿ãƒ¼ã€ãƒãƒ‹ãƒ©",
            allergens: "å°éº¦ãƒ»åµãƒ»ä¹³",
            bakeTime: "9:00 / 12:00 / 15:30",
            storage: "å½“æ—¥ä¸­ï¼ˆã‚¯ãƒªãƒ¼ãƒ å…¥ã‚Šã®ãŸã‚ï¼‰",
          },
          stock: 0,
        },
        {
          id: 107,
          name: "ãã‚‹ã¿ï¼†ãƒ¬ãƒ¼ã‚ºãƒ³é£Ÿãƒ‘ãƒ³",
          category: "é£Ÿãƒ‘ãƒ³",
          price: 450,
          description: "ãã‚‹ã¿ã®é¦™ã°ã—ã•ã¨ãƒ¬ãƒ¼ã‚ºãƒ³ã®ç”˜ã¿ã€‚ãƒãƒ¼ã‚ºã¨ã‚‚ç›¸æ€§æŠœç¾¤ã€‚",
          rating: 4,
          isNew: false,
          tags: ["é¦™ã°ã—", "æœé£Ÿ"],
          createdAt: "2025-10-05",
          details: {
            ingredients: "å°éº¦ç²‰ã€ãã‚‹ã¿ã€ãƒ¬ãƒ¼ã‚ºãƒ³ã€ãƒã‚¿ãƒ¼ã€ç ‚ç³–ã€å¡©",
            allergens: "å°éº¦ãƒ»ä¹³ãƒ»ãã‚‹ã¿",
            bakeTime: "11:00 / 15:00",
            storage: "å¸¸æ¸©ã§1ã€œ2æ—¥ã€å†·å‡ã§ç´„2é€±é–“",
          },
          stock: 0,
        },
        {
          id: 108,
          name: "ã‚ã‚“ãƒã‚¿ãƒ¼ã‚µãƒ³ãƒ‰",
          category: "è“å­ãƒ‘ãƒ³",
          price: 300,
          description: "ç²’ã‚ã‚“Ã—ç™ºé…µãƒã‚¿ãƒ¼ã€‚ç”˜ã˜ã‚‡ã£ã±ã•ãŒã‚¯ã‚»ã«ãªã‚‹ã€åˆå¾Œã®å®šç•ªã€‚",
          rating: 4,
          isNew: true,
          tags: ["ã”è¤’ç¾", "å’Œ"],
          createdAt: "2025-11-18",
          details: {
            ingredients: "å°éº¦ç²‰ã€ç²’ã‚ã‚“ã€ç™ºé…µãƒã‚¿ãƒ¼ã€ç ‚ç³–ã€å¡©",
            allergens: "å°éº¦ãƒ»ä¹³",
            bakeTime: "12:00 / 16:00",
            storage: "å½“æ—¥ä¸­æ¨å¥¨ã€‚å†·è”µã¯ãƒã‚¿ãƒ¼ãŒç¡¬ããªã‚‹ãŸã‚æ³¨æ„",
          },
          stock: 0,
        },
        {
          id: 109,
          name: "æè±†ãƒ™ãƒ¼ã‚³ãƒ³ã‚¨ãƒ”",
          category: "æƒ£èœãƒ‘ãƒ³",
          price: 360,
          description: "å™›ã‚€ã»ã©æ—¨ã„ã€‚æè±†ã®é£Ÿæ„Ÿã¨ãƒ™ãƒ¼ã‚³ãƒ³ã®å¡©æ°—ãŒãƒ™ã‚¹ãƒˆãƒãƒ©ãƒ³ã‚¹ã€‚",
          rating: 3,
          isNew: false,
          tags: ["é£Ÿæ„Ÿ", "ãƒ“ãƒ¼ãƒ«ã«åˆã†"],
          createdAt: "2025-10-28",
          details: {
            ingredients: "å°éº¦ç²‰ã€æè±†ã€ãƒ™ãƒ¼ã‚³ãƒ³ã€å¡©ã€é…µæ¯",
            allergens: "å°éº¦ãƒ»ä¹³ï¼ˆãƒ™ãƒ¼ã‚³ãƒ³åŠ å·¥ç”±æ¥ã®å¯èƒ½æ€§ï¼‰",
            bakeTime: "10:30 / 14:00",
            storage: "å½“æ—¥ä¸­ã€‚ç¿Œæ—¥ã¯ãƒˆãƒ¼ã‚¹ãƒˆã§é¦™ã°ã—ã•å¾©æ´»",
          },
          stock: 0,
        },
        {
          id: 110,
          name: "ãƒãƒ‹ãƒ¼ãƒŠãƒƒãƒ„ãƒ–ãƒªã‚ªãƒƒã‚·ãƒ¥",
          category: "å­£ç¯€é™å®š",
          price: 340,
          description: "ã¯ã¡ã¿ã¤ã®é¦™ã‚Šã¨ãƒŠãƒƒãƒ„ã®ã‚³ã‚¯ã€‚ãµã‚“ã‚ã‚Šãƒªãƒƒãƒãªå£å½“ãŸã‚Šã€‚",
          rating: 5,
          isNew: true,
          tags: ["å­£ç¯€", "é¦™ã‚Š"],
          createdAt: "2025-11-27",
          details: {
            ingredients: "å°éº¦ç²‰ã€åµã€ãƒã‚¿ãƒ¼ã€ã¯ã¡ã¿ã¤ã€ãƒŠãƒƒãƒ„ã€ç ‚ç³–",
            allergens: "å°éº¦ãƒ»åµãƒ»ä¹³ãƒ»ãã‚‹ã¿ï¼ˆãƒŠãƒƒãƒ„é¡ï¼‰",
            bakeTime: "11:00 / 15:30",
            storage: "å½“æ—¥ã€œç¿Œæ—¥ã€‚ä¹¾ç‡¥ã—ã‚„ã™ã„ã®ã§å¯†å°æ¨å¥¨",
          },
          stock: 0,
        },
      ];

      const CATEGORIES = ["é£Ÿãƒ‘ãƒ³", "è“å­ãƒ‘ãƒ³", "æƒ£èœãƒ‘ãƒ³", "å­£ç¯€é™å®š"];

      /** ===== State ===== */
      const state = {
        selectedProductId: null,
        recommendedId: null,
        filterCategory: "all",
        sortBy: "popular",
        searchText: "",
        reservations: [],
      };

      /** ===== DOM ===== */
      const $ = (sel, root = document) => root.querySelector(sel);

      const elShopName = $("#shopName");
      const elTodayDate = $("#todayDate");
      const elTodayText = $("#todayText");
      const elSelectedName = $("#selectedName");

      const elFilterCategory = $("#filterCategory");
      const elSortBy = $("#sortBy");
      const elSearchText = $("#searchText");
      const elResultCount = $("#resultCount");

      const elCards = $("#cards");
      const elEmptyState = $("#emptyState");

      const elXCopy = $("#xCopy");
      const elIGCopy = $("#igCopy");
      const elXLen = $("#xLen");
      const elIGLen = $("#igLen");
      const elSnsInfo = $("#snsInfo");

      const elReservationEmpty = $("#reservationEmpty");
      const elReservationList = $("#reservationList");

      const elBtnPick = $("#btnPick");
      const elBtnScrollReservation = $("#btnScrollReservation");
      const elBtnClearReservation = $("#btnClearReservation");

      const elModalBackdrop = $("#modalBackdrop");
      const elBtnCloseModal = $("#btnCloseModal");
      const elBtnCloseModal2 = $("#btnCloseModal2");
      const elModalTitle = $("#modalTitle");
      const elModalSub = $("#modalSub");
      const elModalName = $("#modalName");
      const elModalDesc = $("#modalDesc");
      const elModalKv = $("#modalKv");
      const elModalRating = $("#modalRating");
      const elModalStockText = $("#modalStockText");
      const elFormTargetName = $("#formTargetName");

      const elReserveForm = $("#reserveForm");
      const elRName = $("#rName");
      const elRPhone = $("#rPhone");
      const elRTime = $("#rTime");
      const elRQty = $("#rQty");
      const elRMemo = $("#rMemo");

      const elErrName = $("#errName");
      const elErrPhone = $("#errPhone");
      const elErrTime = $("#errTime");
      const elErrQty = $("#errQty");
      const elReserveOk = $("#reserveOk");

      const elBtnUseForSNS = $("#btnUseForSNS");

      const elBtnCopyX = $("#btnCopyX");
      const elBtnCopyIG = $("#btnCopyIG");

      const elToast = $("#toast");

      /** ===== Utils ===== */
      function formatYmd(date = new Date()) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, "0");
        const d = String(date.getDate()).padStart(2, "0");
        return `${y}-${m}-${d}`;
      }

      function yen(n) {
        const num = Number(n);
        if (!Number.isFinite(num)) return "â€”";
        return `${num.toLocaleString("ja-JP")}å††`;
      }

      function clampInt(n, min, max) {
        const v = Number.parseInt(String(n), 10);
        if (!Number.isFinite(v)) return min;
        return Math.min(max, Math.max(min, v));
      }

      function safeText(s) {
        return String(s ?? "").replace(/\s+/g, " ").trim();
      }

      function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function stars(rating) {
        const r = clampInt(rating, 1, 5);
        return "â˜…".repeat(r) + "â˜†".repeat(5 - r);
      }

      function pickRandomProductId(excludeId = null) {
        const ids = products.map(p => p.id).filter(id => id !== excludeId);
        if (ids.length === 0) return excludeId;
        return ids[Math.floor(Math.random() * ids.length)];
      }

      function getProductById(id) {
        return products.find(p => p.id === id) || null;
      }

      function categoryIcon(category) {
        switch (category) {
          case "é£Ÿãƒ‘ãƒ³": return "ğŸ";
          case "è“å­ãƒ‘ãƒ³": return "ğŸ¥";
          case "æƒ£èœãƒ‘ãƒ³": return "ğŸ¥ª";
          case "å­£ç¯€é™å®š": return "ğŸ";
          default: return "ğŸ¥–";
        }
      }

      function showToast(message) {
        const msg = safeText(message);
        if (!msg) return;
        elToast.textContent = msg;
        elToast.classList.add("show");
        window.clearTimeout(showToast._t);
        showToast._t = window.setTimeout(() => elToast.classList.remove("show"), 1800);
      }

      async function copyToClipboard(text) {
        const t = String(text ?? "");
        if (!t) return false;

        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(t);
            return true;
          }
        } catch (_) {}

        try {
          const ta = document.createElement("textarea");
          ta.value = t;
          ta.setAttribute("readonly", "true");
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          ta.style.top = "0";
          document.body.appendChild(ta);
          ta.select();
          const ok = document.execCommand("copy");
          document.body.removeChild(ta);
          return ok;
        } catch (_) {
          return false;
        }
      }

      /** ===== Storage ===== */
      const STORAGE_KEY = "bakery_promo_reservations_v1";

      function loadReservations() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed
            .filter(x => x && typeof x === "object")
            .slice(0, 30);
        } catch (_) {
          return [];
        }
      }

      function saveReservations(list) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
        } catch (_) {
          // localStorageãŒä½¿ãˆãªã„å ´åˆã¯é»™ã£ã¦è½ã¨ã™ï¼ˆå‹•ä½œç¶™ç¶šï¼‰
        }
      }

      /** ===== Filtering / Sorting ===== */
      function matchesFilter(p) {
        if (!p) return false;

        const cat = state.filterCategory;
        if (cat !== "all" && p.category !== cat) return false;

        const q = safeText(state.searchText).toLowerCase();
        if (q) {
          const hay = `${p.name} ${p.description} ${(p.tags || []).join(" ")}`.toLowerCase();
          if (!hay.includes(q)) return false;
        }
        return true;
      }

      function sortProducts(list) {
        const key = state.sortBy;
        const arr = [...list];

        if (key === "popular") {
          arr.sort((a,b) => {
            const d = (b.rating - a.rating);
            if (d !== 0) return d;
            // ãŠã™ã™ã‚ã‚’å°‘ã—ä¸Šã«
            const ar = (a.id === state.recommendedId) ? -1 : 0;
            const br = (b.id === state.recommendedId) ? -1 : 0;
            if (ar !== br) return ar - br;
            return b.price - a.price;
          });
        } else if (key === "priceAsc") {
          arr.sort((a,b) => {
            const d = (a.price - b.price);
            if (d !== 0) return d;
            return b.rating - a.rating;
          });
        } else if (key === "newest") {
          arr.sort((a,b) => {
            // createdAt desc
            const da = new Date(a.createdAt).getTime();
            const db = new Date(b.createdAt).getTime();
            const d = (db - da);
            if (d !== 0) return d;
            return b.rating - a.rating;
          });
        }
        return arr;
      }

      /** ===== Rendering ===== */
      function renderHeader() {
        elShopName.textContent = SHOP.name;
        const today = formatYmd(new Date());
        elTodayDate.textContent = today;
        elTodayText.textContent = `ä»Šæ—¥: ${today}`;
      }

      function renderCards() {
        const filtered = products.filter(matchesFilter);
        const sorted = sortProducts(filtered);

        elResultCount.textContent = `${sorted.length} ä»¶`;
        elCards.innerHTML = "";

        if (sorted.length === 0) {
          elEmptyState.style.display = "block";
          return;
        } else {
          elEmptyState.style.display = "none";
        }

        const frag = document.createDocumentFragment();
        for (const p of sorted) {
          frag.appendChild(buildCard(p));
        }
        elCards.appendChild(frag);
      }

      function buildCard(p) {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "card";
        btn.setAttribute("aria-label", `${p.name} ã®è©³ç´°ã‚’é–‹ã`);
        btn.dataset.id = String(p.id);

        const stock = clampInt(p.stock, 0, 99);
        const lowStock = stock > 0 && stock <= 3;

        btn.innerHTML = `
          <div class="badge ${p.id === state.recommendedId ? "show" : ""}">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2l2.4 6.7H21l-5.4 4 2.1 6.8-5.7-4.1-5.7 4.1 2.1-6.8L3 8.7h6.6L12 2z"/></svg>
            æœ¬æ—¥ã®ãŠã™ã™ã‚
          </div>
          <div class="card-top">
            <div class="thumb" aria-hidden="true" title="${p.category}">
              ${breadSvg(categoryIcon(p.category))}
            </div>
            <div class="title">
              <div class="name" title="${escapeHtml(p.name)}">${escapeHtml(p.name)}</div>
              <div class="meta2">
                <span class="tag">${escapeHtml(p.category)} ${categoryIcon(p.category)}</span>
                ${p.isNew ? `<span class="tag new">æ–°å•†å“</span>` : ""}
                ${lowStock ? `<span class="tag low">æ®‹ã‚Šã‚ãšã‹</span>` : ""}
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="desc">${escapeHtml(p.description)}</div>
            <div class="price-row">
              <div class="price">${yen(p.price)}</div>
              <div class="rating" aria-label="äººæ°—åº¦">${stars(p.rating)}</div>
            </div>
          </div>
        `;

        btn.addEventListener("click", () => openModal(p.id));
        btn.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openModal(p.id);
          }
        });
        return btn;
      }

      function breadSvg(emoji) {
        // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€SVGï¼ˆå¤–éƒ¨ä¸è¦ï¼‰
        return `
          <svg viewBox="0 0 64 64" aria-hidden="true">
            <defs>
              <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="rgba(194,123,56,.35)"/>
                <stop offset="1" stop-color="rgba(139,92,246,.22)"/>
              </linearGradient>
            </defs>
            <rect x="6" y="10" width="52" height="44" rx="16" fill="url(#g)" stroke="rgba(229,231,235,.9)"/>
            <text x="32" y="40" text-anchor="middle" font-size="24" font-family="system-ui" fill="rgba(29,29,31,.85)">${emoji}</text>
          </svg>
        `;
      }

      function renderSelectedInfo(p) {
        if (!p) {
          elSelectedName.textContent = "æœªé¸æŠ";
          elSnsInfo.textContent = "æœªé¸æŠ";
          return;
        }
        elSelectedName.textContent = p.name;
        elSnsInfo.textContent = `å¯¾è±¡: ${p.name}`;
      }

      function renderSNSCopies(p) {
        if (!p) {
          elXCopy.value = "";
          elIGCopy.value = "";
          updateLenCounters();
          renderSelectedInfo(null);
          return;
        }

        const today = formatYmd(new Date());
        const stock = clampInt(p.stock, 0, 99);
        const stockLine =
          stock === 0 ? "æ•°é‡é™å®šã€æ—©ã‚ã®ã”æ¥åº—ãŒãŠã™ã™ã‚ã§ã™ã€‚" :
          stock <= 3 ? "æ®‹ã‚Šã‚ãšã‹ã§ã™ã€‚ãŠå–ã‚Šç½®ãã‚‚ã©ã†ãã€‚" :
          "ãŠå–ã‚Šç½®ãã‚‚OKã§ã™ã€‚";

        const tags = (p.tags || []).slice(0, 3).map(t => `#${t.replace(/\s+/g,"")}`).join(" ");
        const catTag = `#${p.category.replace(/\s+/g,"")}`;

        const x = `ã€${SHOP.name}ï½œä»Šæ—¥ã®ãŠã™ã™ã‚ã€‘${p.name} ${yen(p.price)}\n${p.description}\nç„¼ãä¸ŠãŒã‚Š: ${p.details.bakeTime} / ${stockLine}\n${catTag} ${tags}`.slice(0, 100);
        const ig = `æœ¬æ—¥ã®ãƒ‘ãƒ³æƒ…å ±ï¼ˆ${today}ï¼‰\n\n${p.name}ï¼ˆ${p.category}ï¼‰ ${yen(p.price)}\n${p.description}\n\nç„¼ãä¸ŠãŒã‚Š: ${p.details.bakeTime}\nä¿å­˜: ${p.details.storage}\n\n${stockLine}\n#${SHOP.name.replace(/\s+/g,"")} ${catTag} ${tags}`.slice(0, 140);

        elXCopy.value = x;
        elIGCopy.value = ig;

        updateLenCounters();
        renderSelectedInfo(p);
      }

      function updateLenCounters() {
        elXLen.textContent = `${(elXCopy.value || "").length} æ–‡å­—`;
        elIGLen.textContent = `${(elIGCopy.value || "").length} æ–‡å­—`;
      }

      function renderReservations() {
        const list = state.reservations || [];
        if (!Array.isArray(list) || list.length === 0) {
          elReservationEmpty.style.display = "block";
          elReservationList.style.display = "none";
          elReservationList.innerHTML = "";
          return;
        }
        elReservationEmpty.style.display = "none";
        elReservationList.style.display = "grid";

        elReservationList.innerHTML = "";
        const frag = document.createDocumentFragment();

        // æ–°ã—ã„ã‚‚ã®ãŒä¸Š
        const sorted = [...list].sort((a,b) => (b.createdAt || 0) - (a.createdAt || 0)).slice(0, 8);
        for (const r of sorted) {
          const p = getProductById(r.productId);
          const item = document.createElement("div");
          item.className = "summary-item";
          const name = p ? p.name : "ï¼ˆå•†å“ä¸æ˜ï¼‰";
          const time = safeText(r.pickupTime);
          const qty = clampInt(r.qty, 1, 999);
          const memo = safeText(r.memo);
          const phone = safeText(r.phone).replace(/(\d{3})(\d{4})(\d{4})/, "$1-$2-$3");
          const created = r.createdAtYmd || "â€”";

          item.innerHTML = `
            <div class="k">${escapeHtml(created)} / å–ã‚Šç½®ã</div>
            <div class="v">${escapeHtml(name)} Ã— ${qty}ï¼ˆ${escapeHtml(time)}ï¼‰</div>
            <div style="margin-top:6px; color:var(--muted); font-size:12px; line-height:1.45;">
              ãŠåå‰: ${escapeHtml(r.name)} / TEL: ${escapeHtml(phone)}<br/>
              ${memo ? `ãƒ¡ãƒ¢: ${escapeHtml(memo)}` : "ãƒ¡ãƒ¢: ãªã—"}
            </div>
          `;
          frag.appendChild(item);
        }
        elReservationList.appendChild(frag);
      }

      /** ===== Modal ===== */
      function openModal(productId) {
        const p = getProductById(productId);
        if (!p) return;

        state.selectedProductId = p.id;
        renderSelectedInfo(p);

        elModalTitle.textContent = `å•†å“è©³ç´°`;
        elModalName.textContent = p.name;
        elModalDesc.textContent = p.description;

        const badges = [
          `${p.category} ${categoryIcon(p.category)}`,
          p.isNew ? "æ–°å•†å“" : null,
          (p.id === state.recommendedId) ? "æœ¬æ—¥ã®ãŠã™ã™ã‚" : null,
        ].filter(Boolean);

        elModalSub.innerHTML = badges.map(b => `<span class="tag">${escapeHtml(b)}</span>`).join(" ");

        elModalKv.innerHTML = `
          <dt>ä¾¡æ ¼</dt><dd><strong>${yen(p.price)}</strong></dd>
          <dt>åŸææ–™</dt><dd>${escapeHtml(p.details.ingredients)}</dd>
          <dt>ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³</dt><dd>${escapeHtml(p.details.allergens)}</dd>
          <dt>ç„¼ãä¸ŠãŒã‚Š</dt><dd>${escapeHtml(p.details.bakeTime)}</dd>
          <dt>ä¿å­˜æ–¹æ³•</dt><dd>${escapeHtml(p.details.storage)}</dd>
        `;

        elModalRating.textContent = stars(p.rating);

        const stock = clampInt(p.stock, 0, 99);
        const stockText =
          stock === 0 ? "åœ¨åº«: å°‘ãªã‚ï¼ˆæ—©ã‚æ¨å¥¨ï¼‰" :
          stock <= 3 ? `åœ¨åº«: ${stock}ï¼ˆæ®‹ã‚Šã‚ãšã‹ï¼‰` :
          `åœ¨åº«: ${stock}`;
        elModalStockText.textContent = stockText;

        elFormTargetName.textContent = `å¯¾è±¡: ${p.name}`;

        clearFormErrors();
        elReserveOk.style.display = "none";
        // ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸå€¤ï¼ˆéå»å…¥åŠ›ã‚’æ®‹ã—ãŸã„å ´åˆã¯ã“ã“ã§ã—ãªã„ï¼‰
        elRQty.value = "";
        elRMemo.value = "";
        // åå‰ã¨é›»è©±ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å„ªã—ãã€å‰å›å…¥åŠ›ã‚’æ®‹ã™ï¼ˆlocalStorageã¯æ‰±ã‚ãªã„ï¼‰
        elRTime.value = "";

        elModalBackdrop.classList.add("show");
        elModalBackdrop.setAttribute("aria-hidden", "false");

        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’Closeã¸
        elBtnCloseModal.focus();

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã„ãŸã‚‰SNSã‚³ãƒ”ãƒ¼ã‚‚æ›´æ–°ï¼ˆé¸æŠä¸­ã‚’å„ªå…ˆï¼‰
        renderSNSCopies(p);
        renderCards(); // ãŠã™ã™ã‚ãƒãƒƒã‚¸ç­‰å†æç”»
      }

      function closeModal() {
        elModalBackdrop.classList.remove("show");
        elModalBackdrop.setAttribute("aria-hidden", "true");
      }

      function isModalOpen() {
        return elModalBackdrop.classList.contains("show");
      }

      /** ===== Validation ===== */
      function clearFormErrors() {
        elErrName.textContent = "";
        elErrPhone.textContent = "";
        elErrTime.textContent = "";
        elErrQty.textContent = "";
      }

      function validateReservationForm() {
        clearFormErrors();
        let ok = true;

        const name = safeText(elRName.value);
        const phone = safeText(elRPhone.value).replace(/[^\d]/g, "");
        const time = safeText(elRTime.value);
        const qtyRaw = safeText(elRQty.value);

        if (!name) {
          elErrName.textContent = "ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          ok = false;
        }
        if (!phone) {
          elErrPhone.textContent = "é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          ok = false;
        } else if (!/^\d{10,11}$/.test(phone)) {
          elErrPhone.textContent = "é›»è©±ç•ªå·ã¯10ã€œ11æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—ã§ã‚‚å¯ï¼‰ã€‚";
          ok = false;
        }
        if (!time) {
          elErrTime.textContent = "å—å–å¸Œæœ›æ™‚é–“ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚";
          ok = false;
        }
        const qty = Number(qtyRaw);
        if (!qtyRaw) {
          elErrQty.textContent = "å€‹æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          ok = false;
        } else if (!Number.isFinite(qty) || qty < 1 || !Number.isInteger(qty)) {
          elErrQty.textContent = "å€‹æ•°ã¯1ä»¥ä¸Šã®æ•´æ•°ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
          ok = false;
        }

        return {
          ok,
          value: {
            name,
            phone,
            pickupTime: time,
            qty: Number.isFinite(qty) ? qty : 1,
            memo: safeText(elRMemo.value),
          }
        };
      }

      /** ===== Actions ===== */
      function initStocks() {
        // ãƒ€ãƒŸãƒ¼åœ¨åº«ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ä¸€å®šã«ã—ãŸã„å ´åˆã¯å›ºå®šseedãŒå¿…è¦ã€‚ã“ã“ã¯æ¯å›ãƒ©ãƒ³ãƒ€ãƒ ã§OKï¼‰
        for (const p of products) {
          // å­£ç¯€é™å®šã‚„æ–°å•†å“ã¯å°‘ãªã‚ã«ã—ã¦ã€Œæ®‹ã‚Šã‚ãšã‹ã€ã‚’å‡ºã—ã‚„ã™ã
          const baseMax = p.category === "å­£ç¯€é™å®š" || p.isNew ? 6 : 10;
          const v = randomInt(0, baseMax);
          p.stock = v;
        }
      }

      function setRecommended(productId) {
        const p = getProductById(productId);
        if (!p) return;
        state.recommendedId = p.id;
        // ãŠã™ã™ã‚ãŒé¸ã°ã‚ŒãŸã‚‰é¸æŠä¸­ã«ã‚‚åæ˜ ï¼ˆUXï¼‰
        state.selectedProductId = p.id;
        renderSNSCopies(p);
        renderCards();
      }

      function getSelectedOrRecommended() {
        const selected = getProductById(state.selectedProductId);
        if (selected) return selected;
        const rec = getProductById(state.recommendedId);
        return rec;
      }

      function handlePickRecommended() {
        const nextId = pickRandomProductId(state.recommendedId);
        setRecommended(nextId);
        const p = getProductById(nextId);
        showToast(`æœ¬æ—¥ã®ãŠã™ã™ã‚ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼š${p ? p.name : "â€”"}`);
      }

      function handleFiltersChanged() {
        state.filterCategory = elFilterCategory.value;
        state.sortBy = elSortBy.value;
        state.searchText = elSearchText.value || "";
        renderCards();
      }

      function handleReservationSubmit(e) {
        e.preventDefault();

        const p = getProductById(state.selectedProductId);
        if (!p) {
          showToast("å•†å“ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚«ãƒ¼ãƒ‰ã‹ã‚‰å•†å“ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
          return;
        }

        const res = validateReservationForm();
        if (!res.ok) {
          showToast("å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        const payload = {
          id: `r_${Date.now()}_${Math.random().toString(16).slice(2)}`,
          productId: p.id,
          name: res.value.name,
          phone: res.value.phone,
          pickupTime: res.value.pickupTime,
          qty: res.value.qty,
          memo: res.value.memo,
          createdAt: Date.now(),
          createdAtYmd: formatYmd(new Date()),
        };

        state.reservations = [payload, ...(state.reservations || [])].slice(0, 30);
        saveReservations(state.reservations);

        elReserveOk.style.display = "block";
        elReserveOk.textContent = `äºˆç´„å†…å®¹ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆæ“¬ä¼¼ï¼‰ã€‚ã€Œ${p.name}ã€Ã—${payload.qty} / å—å–: ${payload.pickupTime}`;

        renderReservations();
        showToast("äºˆç´„å†…å®¹ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");
      }

      function handleClearReservations() {
        state.reservations = [];
        saveReservations([]);
        renderReservations();
        showToast("äºˆç´„å†…å®¹ã‚’æ¶ˆå»ã—ã¾ã—ãŸã€‚");
      }

      function handleUseForSNS() {
        const p = getProductById(state.selectedProductId);
        if (!p) return;
        renderSNSCopies(p);
        showToast("SNSç”¨ã‚³ãƒ”ãƒ¼ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚");
      }

      async function handleCopy(kind) {
        const text = kind === "x" ? elXCopy.value : elIGCopy.value;
        const ok = await copyToClipboard(text);
        showToast(ok ? "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚" : "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®æ¨©é™ã‚’ã”ç¢ºèªãã ã•ã„ã€‚");
      }

      function scrollToReservation() {
        const target = $("#reservationSummary");
        if (!target) return;
        target.scrollIntoView({ behavior: "smooth", block: "start" });
      }

      /** ===== Security-ish for innerHTML text parts ===== */
      function escapeHtml(str) {
        return String(str ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      /** ===== Init ===== */
      function init() {
        // Shop info
        elShopName.textContent = SHOP.name;
        renderHeader();

        // Stocks
        initStocks();

        // Load reservations
        state.reservations = loadReservations();
        renderReservations();

        // Default recommended
        state.recommendedId = pickRandomProductId(null);
        state.selectedProductId = state.recommendedId;

        // Controls initial
        elFilterCategory.value = state.filterCategory;
        elSortBy.value = state.sortBy;
        elSearchText.value = state.searchText;

        // Render
        renderCards();
        renderSNSCopies(getSelectedOrRecommended());

        // Events
        elBtnPick.addEventListener("click", handlePickRecommended);
        elFilterCategory.addEventListener("change", handleFiltersChanged);
        elSortBy.addEventListener("change", handleFiltersChanged);
        elSearchText.addEventListener("input", handleFiltersChanged);

        elBtnScrollReservation.addEventListener("click", scrollToReservation);
        elBtnClearReservation.addEventListener("click", handleClearReservations);

        elBtnCloseModal.addEventListener("click", closeModal);
        elBtnCloseModal2.addEventListener("click", closeModal);

        elModalBackdrop.addEventListener("click", (e) => {
          if (e.target === elModalBackdrop) closeModal();
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && isModalOpen()) {
            e.preventDefault();
            closeModal();
          }
        });

        elReserveForm.addEventListener("submit", handleReservationSubmit);
        elBtnUseForSNS.addEventListener("click", handleUseForSNS);

        elBtnCopyX.addEventListener("click", () => handleCopy("x"));
        elBtnCopyIG.addEventListener("click", () => handleCopy("ig"));

        // When modal closes, keep selection but just close
        // When selection changes, update header selection name
        // Already covered in renderSNSCopies/renderSelectedInfo
      }

      init();
    })();
  </script>
</body>
</html>
